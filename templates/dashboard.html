{% include 'header.html' %} {% load static %}

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Analytics Dashboard - AI Invigilator</title>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/all.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <style>
      .dashboard-container {
        max-width: 1400px;
        margin: 40px auto;
        padding: 20px;
      }

      .dashboard-title {
        text-align: center;
        color: #333;
        margin-bottom: 30px;
        font-size: 2.5rem;
        font-weight: 700;
      }

      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 40px;
      }

      .stat-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 25px;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        transition:
          transform 0.3s ease,
          box-shadow 0.3s ease;
      }

      .stat-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
      }

      .stat-card.green {
        background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
      }

      .stat-card.orange {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      }

      .stat-card.blue {
        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      }

      .stat-card.red {
        background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
      }

      .stat-icon {
        font-size: 2.5rem;
        margin-bottom: 10px;
      }

      .stat-value {
        font-size: 2.5rem;
        font-weight: 700;
        margin: 10px 0;
      }

      .stat-label {
        font-size: 1rem;
        opacity: 0.9;
        text-transform: uppercase;
        letter-spacing: 1px;
      }

      .charts-section {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
        gap: 30px;
        margin-bottom: 40px;
      }

      .chart-card {
        background: white;
        padding: 25px;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      }

      .chart-title {
        font-size: 1.3rem;
        font-weight: 600;
        color: #333;
        margin-bottom: 20px;
        border-left: 4px solid #667eea;
        padding-left: 15px;
      }

      .table-section {
        background: white;
        padding: 25px;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        margin-bottom: 30px;
      }

      .data-table {
        width: 100%;
        border-collapse: collapse;
      }

      .data-table th {
        background-color: #667eea;
        color: white;
        padding: 12px;
        text-align: left;
        font-weight: 600;
      }

      .data-table td {
        padding: 12px;
        border-bottom: 1px solid #eee;
        color: #333;
      }

      .data-table tr:hover {
        background-color: #f8f9fa;
      }

      .badge {
        display: inline-block;
        padding: 5px 12px;
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: 600;
      }

      .badge-verified {
        background-color: #28a745;
        color: white;
      }

      .badge-pending {
        background-color: #ffc107;
        color: #333;
      }

      .badge-malpractice {
        background-color: #dc3545;
        color: white;
      }

      @media (max-width: 768px) {
        .charts-section {
          grid-template-columns: 1fr;
        }

        .dashboard-title {
          font-size: 2rem;
        }
      }
    </style>
  </head>
  <body>
    <div class="dashboard-container">
      <h1 class="dashboard-title">
        <i class="fas fa-chart-line"></i> Analytics Dashboard
      </h1>

      <!-- Statistics Cards -->
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-icon">
            <i class="fas fa-exclamation-triangle"></i>
          </div>
          <div class="stat-value">{{ total_incidents }}</div>
          <div class="stat-label">Total Incidents</div>
        </div>

        <div class="stat-card green">
          <div class="stat-icon"><i class="fas fa-calendar-day"></i></div>
          <div class="stat-value">{{ today_incidents }}</div>
          <div class="stat-label">Today's Incidents</div>
        </div>

        <div class="stat-card orange">
          <div class="stat-icon"><i class="fas fa-calendar-week"></i></div>
          <div class="stat-value">{{ week_incidents }}</div>
          <div class="stat-label">This Week</div>
        </div>

        <div class="stat-card blue">
          <div class="stat-icon"><i class="fas fa-check-circle"></i></div>
          <div class="stat-value">{{ verified_count }}</div>
          <div class="stat-label">Verified</div>
        </div>

        <div class="stat-card red">
          <div class="stat-icon"><i class="fas fa-clock"></i></div>
          <div class="stat-value">{{ pending_count }}</div>
          <div class="stat-label">Pending Review</div>
        </div>

        <div class="stat-card">
          <div class="stat-icon"><i class="fas fa-ban"></i></div>
          <div class="stat-value">{{ confirmed_malpractice }}</div>
          <div class="stat-label">Confirmed Cases</div>
        </div>
      </div>

      <!-- Charts Section -->
      <div class="charts-section">
        <!-- Daily Trend Chart -->
        <div class="chart-card">
          <h3 class="chart-title">7-Day Trend</h3>
          <canvas id="trendChart"></canvas>
        </div>

        <!-- Malpractice Types Chart -->
        <div class="chart-card">
          <h3 class="chart-title">Top Malpractice Types</h3>
          <canvas id="typeChart"></canvas>
        </div>
      </div>

      <!-- Active Halls Table -->
      <div class="table-section">
        <h3 class="chart-title">Most Active Lecture Halls</h3>
        <table class="data-table">
          <thead>
            <tr>
              <th>Rank</th>
              <th>Building</th>
              <th>Hall Name</th>
              <th>Incident Count</th>
            </tr>
          </thead>
          <tbody>
            {% for hall in active_halls %}
            <tr>
              <td><strong>#{{ forloop.counter }}</strong></td>
              <td>{{ hall.lecture_hall__building }}</td>
              <td>{{ hall.lecture_hall__hall_name }}</td>
              <td>
                <span class="badge badge-malpractice">{{ hall.count }}</span>
              </td>
            </tr>
            {% empty %}
            <tr>
              <td
                colspan="4"
                style="text-align: center; padding: 20px; color: #999"
              >
                No data available
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <!-- Recent Incidents Table -->
      <div class="table-section">
        <h3 class="chart-title">Recent Incidents</h3>
        <table class="data-table">
          <thead>
            <tr>
              <th>Date</th>
              <th>Time</th>
              <th>Malpractice Type</th>
              <th>Hall</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody>
            {% for incident in recent_incidents %}
            <tr>
              <td>{{ incident.date|date:"M d, Y" }}</td>
              <td>{{ incident.time|time:"h:i A" }}</td>
              <td>{{ incident.malpractice }}</td>
              <td>{{ incident.lecture_hall }}</td>
              <td>
                {% if incident.verified %}
                <span class="badge badge-verified">Verified</span>
                {% else %}
                <span class="badge badge-pending">Pending</span>
                {% endif %}
              </td>
            </tr>
            {% empty %}
            <tr>
              <td
                colspan="5"
                style="text-align: center; padding: 20px; color: #999"
              >
                No recent incidents
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

    <script>
      // Daily Trend Chart
      const trendCtx = document.getElementById('trendChart').getContext('2d');
      const trendData = {{ daily_trend|safe }};
      const trendChart = new Chart(trendCtx, {
          type: 'line',
          data: {
              labels: [
                  {% for item in daily_trend %}'{{ item.date }}',{% endfor %}
              ],
              datasets: [{
                  label: 'Incidents',
                  data: [
                      {% for item in daily_trend %}{{ item.count }},{% endfor %}
                  ],
                  borderColor: '#667eea',
                  backgroundColor: 'rgba(102, 126, 234, 0.1)',
                  tension: 0.4,
                  fill: true,
                  pointRadius: 5,
                  pointBackgroundColor: '#667eea',
                  pointBorderColor: '#fff',
                  pointBorderWidth: 2
              }]
          },
          options: {
              responsive: true,
              maintainAspectRatio: true,
              plugins: {
                  legend: {
                      display: false
                  }
              },
              scales: {
                  y: {
                      beginAtZero: true,
                      ticks: {
                          precision: 0
                      }
                  }
              }
          }
      });

      // Malpractice Types Chart
      const typeCtx = document.getElementById('typeChart').getContext('2d');
      const typeChart = new Chart(typeCtx, {
          type: 'doughnut',
          data: {
              labels: [
                  {% for item in malpractice_by_type %}'{{ item.malpractice }}',{% endfor %}
              ],
              datasets: [{
                  data: [
                      {% for item in malpractice_by_type %}{{ item.count }},{% endfor %}
                  ],
                  backgroundColor: [
                      '#667eea', '#764ba2', '#f093fb', '#f5576c',
                      '#11998e', '#38ef7d', '#4facfe', '#00f2fe',
                      '#fa709a', '#fee140'
                  ],
                  borderWidth: 2,
                  borderColor: '#fff'
              }]
          },
          options: {
              responsive: true,
              maintainAspectRatio: true,
              plugins: {
                  legend: {
                      position: 'bottom',
                      labels: {
                          padding: 15,
                          font: {
                              size: 12
                          }
                      }
                  }
              }
          }
      });
    </script>
  </body>
</html>

{% include 'footer.html' %}
